<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Model Parameter Calculator</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="paramcalc.css" />
</head>
<body>
  <div class="container">
    <h1>Model Parameter Calculator</h1>
    <p>
      Enter shapes in HuggingFace style like <code>[151 552, 5 120]</code>. Numbers may include spaces or narrow no‑break spaces; the calculator multiplies dimensions per tensor and sums across lines.
    </p>

    <form id="paramcalc-form">
    <fieldset class="fieldset">
      <legend>Model Structure</legend>
      <div class="form-row">
        <div class="form-group" style="flex:1 1 100%">
          <label for="param-model-select">Choose Model</label>
          <select id="param-model-select">
            <option value="custom" selected>Custom (enter your own values)</option>
            <option value="kimi-k2">Kimi K2</option>
            <option value="deepseek-v3">Deepseek V3</option>
            <option value="deepseek-v3-mtp">Deepseek V3 MTP</option>
            <option value="glm-4.7">GLM 4.7</option>
            <option value="glm-5">GLM 5</option>
            <option value="qwen3-235b">Qwen 3 235B</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="total_layers"><strong>A</strong>: Total layers</label>
          <input type="number" id="total_layers" min="0" step="1" readonly aria-readonly="true" />
          <div class="computed-display muted">Computed as <strong>B</strong> + <strong>C</strong></div>
        </div>
        <div class="form-group">
          <label for="dense_layers"><strong>B</strong>: Dense layers</label>
          <input type="number" id="dense_layers" min="0" step="1" />
        </div>
        <div class="form-group">
          <label for="moe_layers"><strong>C</strong>: MoE layers</label>
          <input type="number" id="moe_layers" min="0" step="1" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group" style="flex:1 1 100%">
          <label for="embedding_shapes"><strong>D</strong>: Embedding/output matrix shapes (one per line)</label>
          <textarea id="embedding_shapes" rows="2" placeholder="[V, D]"></textarea>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group" style="flex:1 1 100%">
          <label for="pre_first_norms"><strong>E</strong>: Pre/post first/last layer norms/others (optional, one per line)</label>
          <textarea id="pre_first_norms" rows="2" placeholder="[D]\n[D]"></textarea>
        </div>
      </div>
    </fieldset>

    <fieldset class="fieldset">
      <legend>Dense Layers</legend>
      <div class="form-row">
        <div class="form-group" style="flex:1 1 100%">
          <label for="dense_norms"><strong>F</strong>: Norms etc (optional, per dense layer, one per line)</label>
          <textarea id="dense_norms" rows="3" placeholder="[D]\n[D]"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group" style="flex:1 1 100%">
          <label for="dense_attn"><strong>G</strong>: Attention tensors (per dense layer, one per line)</label>
          <textarea id="dense_attn" rows="10" placeholder="[D, D]\n[D, D]\n[D]"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group" style="flex:1 1 100%">
          <label for="dense_ffn"><strong>H</strong>: FFN tensors (per dense layer, one per line)</label>
          <textarea id="dense_ffn" rows="4" placeholder="[D, 4D]\n[4D, D]\n[D]"></textarea>
        </div>
      </div>
    </fieldset>

    <fieldset class="fieldset">
      <legend>MoE Layers</legend>
      <div class="form-row">
        <div class="form-group">
          <label for="experts_per_layer"><strong>I</strong>: Experts per MoE layer</label>
          <input type="number" id="experts_per_layer" min="0" step="1" />
        </div>
        <div class="form-group">
          <label for="active_experts"><strong>J</strong>: Active experts per MoE layer</label>
          <input type="number" id="active_experts" min="0" step="1" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group" style="flex: 1 1 200px">
          <label><input type="checkbox" id="has_shared_expert" /> Include shared expert</label>
        </div>
        <div class="form-group" style="flex: 1 1 200px">
          <label for="shared_expert_scope"><strong>L</strong>: Shared expert scope</label>
          <select id="shared_expert_scope" disabled>
            <option value="global">Global (single copy)</option>
            <option value="per_layer" selected>Per MoE layer</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group" style="flex:1 1 100%">
          <label for="shared_expert_tensors"><strong>M</strong>: Shared expert tensors</label>
          <textarea id="shared_expert_tensors" rows="3" placeholder="[H, D]\n[D, H]" disabled></textarea>
          <div class="info-text">Shared expert parameters are counted under FFN totals.</div>
        </div>
      </div>

      
      <div class="form-row">
        <div class="form-group" style="flex:1 1 100%">
          <label for="moe_attn"><strong>N</strong>: Attention tensors (per MoE layer, one per line)</label>
          <textarea id="moe_attn" rows="10" placeholder="[D, D]\n[D, D]\n[D]"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group" style="flex:1 1 100%">
          <label for="moe_transitional"><strong>O</strong>: Norms / transitional (optional, per MoE layer, one per line)</label>
          <textarea id="moe_transitional" rows="3" placeholder="[D]\n[D]\n[D, D]"></textarea>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group" style="flex:1 1 100%">
          <label for="moe_shared_ffn"><strong>P</strong>: Gate input, biases, other FFN (always active)</label>
          <textarea id="moe_shared_ffn" rows="3" placeholder="[D, H]\n[H, D]\n[D]"></textarea>
          <div class="info-text">Included in FFN parameter totals.</div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group" style="flex:1 1 100%">
          <label for="moe_experts"><strong>Q</strong>: MoE experts tensors (per MoE layer; may include expert dim E)</label>
          <textarea id="moe_experts" rows="4" placeholder="Per-layer: [E, H, D] or sum of all expert weights on one line"></textarea>
          <label class="single-gpu-label"><input type="checkbox" id="experts_include_dim" checked aria-describedby="experts_include_dim_note" /> Tensors include expert dimension (E)</label>
          <div id="experts_include_dim_note" class="info-text">If unchecked, shapes are treated as per‑expert and multiplied by the number of experts.</div>
        </div>
      </div>
    </fieldset>

    <div class="form-group">
      <button id="calculate-btn" type="submit">Calculate</button>
    </div>
    
    <div id="results" class="results hidden" aria-live="polite"></div>
    <div id="explanation" class="results hidden" aria-live="polite"></div>
    </form>
  </div>
  <script src="paramcalc.js"></script>
  </body>
  </html>
